# 麻醉科護理班表管理系統使用指南 (v0.9.2)

本文檔詳細說明麻醉科護理班表管理系統的各項功能和使用方法。

## 系統概覽

麻醉科護理班表管理系統是專為麻醉科部門設計的班表管理工具，支援護理長排班和護理師查詢班表的完整流程。系統支援角色權限管理、公式化排班、智能分配、調班管理等完整功能，並整合了醫師班表查詢系統。

## 登入方式

### 1. 傳統密碼登入
- 輸入用戶名和密碼
- 點擊「登入」按鈕

### 2. Passkey無密碼登入 (WebAuthn)
- 點擊「使用Passkey登入」按鈕
- 使用生物辨識（指紋、Face ID）或PIN碼驗證
- 支援跨裝置使用

## 系統角色與權限

### 護理長 (head_nurse)
- 完整系統管理權限
- 排班管理與班表發布
- 用戶管理
- 公告發布
- 換班審核
- 加班管理與智能分配

### 一般護理師 (nurse)
- 查詢個人班表
- 查看月班表
- 申請換班
- 查看公告

### 麻醉科Leader (leader)
- 查詢個人和團隊班表
- 有限的管理權限
- 可查看相關統計資訊

### 麻醉科書記 (secretary)
- 查詢個人班表
- 協助班表管理
- 查看公告和系統資訊

## 主要功能詳解

### 1. 儀表板 (Dashboard)

儀表板提供系統概覽：
- **今日班表**：顯示當天的班表資訊
- **最新公告**：顯示最近發布的公告
- **換班請求**：顯示待處理的換班申請
- **系統統計**：用戶數量、班表數量等統計資訊

### 2. 用戶管理 (僅護理長)

#### 護理師身份分類
系統支援四種護理師身份：
- **麻醉專科護理師**：班型為 D(日班)、A(小夜班)、N(大夜班)、O(休假)
- **恢復室護理師**：班型為 A(日班)、K(早班)、C(中班)、F(晚班)、O(休假)
- **麻醉科Leader**：班型為 A(日班)、E(半班)、O(休假)
- **麻醉科書記**：班型為 B(日班)、E(半班)、O(休假)

#### 用戶管理操作
- **新增用戶**：設定姓名、用戶名、密碼、身份、角色
- **編輯用戶**：修改用戶資訊
- **刪除用戶**：移除用戶帳號
- **調整順序**：設定護理師在班表中的顯示順序

### 3. 公式班表設定 (僅護理長)

公式班表是月班表生成的基礎模板：

#### 設定步驟
1. **選擇身份類別**：麻醉專科護理師、恢復室護理師等
2. **設定組別數量**：每種身份可設定多個組別
3. **配置班表模式**：設定各組別的排班循環模式
4. **儲存設定**：完成後儲存公式班表

#### 班表模式說明
- 每個組別可設定不同的排班循環
- 支援複雜的排班模式組合
- 可預覽班表效果

### 4. 月班表管理

#### 月班表生成 (護理長)
1. **選擇月份**：選擇要生成班表的月份
2. **套用公式班表**：系統自動根據公式班表生成初始班表
3. **手動調整**：可手動修改特定日期的班別
4. **工作分配**：為A班護理師分配工作區域
5. **發布班表**：確認無誤後發布班表

#### 工作分配功能
- **主要工作分配**：基本工作區域分配（OR、DR、3F等）
- **PM工作分配**：新增複選PM工作分配功能 (v0.9.2新增)
- **快速分配**：提供一鍵分配功能
- **統計顯示**：顯示工作分配統計資訊
- **智能分配**：採用輪次分配算法的加班自動分配系統

#### 夜班包班管理
- **小夜班包班(SNP)**：專門處理小夜班的包班護理師
- **大夜班包班(LNP)**：專門處理大夜班的包班護理師
- **分類顯示**：標籤頁分別顯示常規、SNP、LNP班表
- **一鍵更新**：護理長可快速更新包班人員列表

#### 月班表查詢 (所有用戶)
- **個人班表**：查看自己的月班表
- **全部班表**：查看所有人員的月班表
- **工作分配查詢**：查看A班工作分配情況
- **PDF匯出**：將班表匯出為PDF格式

### 5. 週班表查詢

週班表提供更詳細的週期性班表檢視：
- **個人週班表**：顯示個人的週班表資訊
- **工作分配顯示**：顯示A班的工作分配詳情
- **班別統計**：統計各班別的人數分布

### 6. 醫師班表系統

#### 功能特色
- **自動更新**：系統每5分鐘自動更新當月班表，每日凌晨更新未來四個月
- **完整資訊**：顯示當值醫師、手術室分配、各科別醫師
- **月份切換**：左右箭頭快速切換月份
- **響應式設計**：優化移動設備顯示
- **資料同步**：與外部醫師班表API整合，自動同步更新
- **狀態顯示**：顯示醫師工作狀態和開會時間

#### 基本使用方法
1. **進入醫師班表頁面**
2. **選擇月份**：使用左右箭頭或點擊月份選擇器
3. **查看當值醫師**：每日顯示當值醫師資訊
4. **手術室分配**：查看各手術室與刀房的醫師分配
5. **科別區分**：顯示不同科別醫師（麻醉科、外科、婦產科等）

#### 醫師資訊顯示

##### 基本資訊
醫師班表顯示包含：
- **當值醫師**：每日的當值醫師資訊
- **手術室分配**：顯示各手術室的醫師安排
- **科別分類**：區分麻醉科、外科、婦產科等不同科別
- **工作時間**：顯示醫師的工作時段

##### 狀態資訊
- **工作狀態**：顯示醫師的當前工作狀態
- **會議時間**：顯示已安排的會議時間
- **特殊安排**：顯示請假或特殊安排資訊

#### 醫師班表更新機制

##### 自動更新系統
1. **定時更新**：
   - 系統每5分鐘自動檢查並更新當月醫師班表
   - 每日凌晨自動更新未來四個月的班表資料

2. **更新日誌**：
   - 記錄每次更新的詳細日誌
   - 包含更新時間、成功狀態、處理天數等資訊
   - 錯誤處理和重試機制

3. **資料同步**：
   - 與外部醫師班表API進行資料同步
   - 處理API連線錯誤和資料格式問題
   - 確保資料的即時性和準確性

#### 使用者體驗優化

##### 響應式設計
- **桌面版**：完整功能顯示，適合班表管理操作
- **平板版**：優化觸控操作，保持功能完整性
- **手機版**：簡化介面，聚焦核心資訊顯示

##### 操作便利性
- **快速導航**：月份快速切換功能
- **資料載入**：Loading狀態顯示和錯誤處理
- **資訊提示**：操作成功和錯誤的即時回饋

#### 錯誤處理與用戶體驗

##### 錯誤處理機制
- **API錯誤**：顯示友善的錯誤訊息
- **網路錯誤**：提供重試機制
- **輸入驗證**：即時驗證使用者輸入

##### 成功操作回饋
- 操作成功後顯示確認訊息
- 自動更新相關狀態和顯示
- 抽屜和對話框自動關閉

#### 資料更新機制
- **即時更新**：定時任務自動獲取最新資料
- **更新日誌**：系統記錄所有更新操作的詳細日誌
- **錯誤處理**：完整的錯誤捕獲與恢復機制
- **狀態同步**：前後端狀態即時同步

### 7. 換班管理

換班系統提供完整的換班申請與審核流程：

#### 申請換班 (一般護理師)
1. **選擇換班日期**：選擇要換班的日期
2. **選擇換班對象**：選擇要與誰換班
3. **輸入申請原因**：說明換班原因
4. **提交申請**：系統自動驗證工時規則

#### 審核換班 (護理長)
1. **查看申請列表**：檢視所有換班申請
2. **審核申請**：同意或拒絕換班申請
3. **查看歷史記錄**：查看所有換班歷史

#### 智能驗證功能
- **班別衝突檢查**：避免排班衝突
- **工時規則驗證**：確保符合勞基法規定
- **休息時間檢查**：確保護理師有足夠休息時間

### 8. 加班管理

#### 加班人員識別
- **自動識別**：系統自動識別月班表中的A班人員
- **排序標記**：A班人員按A-F順序排列
- **分數計算**：自動計算每月加班分數

#### 智能分配系統
- **輪次分配算法**：採用先進的輪次分配機制確保公平性
- **Fisher-Yates洗牌**：隨機化處理避免系統性偏見
- **候選人篩選**：多輪篩選機制，優先選擇負分或零分人員
- **分數平衡**：目標讓所有護理師分數趨近零分
- **回合制公平**：確保每人先得一次再分配額外班別

#### 加班記錄管理 (護理長)
- **編輯加班人員**：調整加班人員名單
- **批量更新**：一次更新多筆加班記錄
- **統計查詢**：查看年度加班統計
- **智能分配**：兩種模式 - 全部重新分配/智能補齊未分配班別

#### 加班分數系統
- **班別分數配置**：A(2.0)、B(1.0)、C(0.8)、D(0.3)、E(0.0)、F(0.0)
- **白班扣分**：未加班白班扣-0.365分
- **月度計算**：每月自動計算加班分數
- **年度統計**：顯示1-12月加班分數統計表
- **身份區分**：專科護理師和Leader分開計算

### 9. 公告專區

#### 發布公告 (護理長)
1. **撰寫公告標題**
2. **輸入公告內容**
3. **選擇公告分類**
4. **設定重要性**：可標記為重要公告
5. **發布公告**

#### 查看公告 (所有用戶)
- **公告列表**：分頁顯示所有公告
- **分類篩選**：按分類篩選公告
- **重要公告**：重要公告會突出顯示
- **搜尋功能**：可搜尋公告內容

### 10. 系統設定

#### 個人資料設定
- **修改個人資訊**：更新姓名、聯絡資訊等
- **變更密碼**：修改登入密碼

#### Passkey管理
- **註冊Passkey**：註冊新的Passkey裝置
- **管理Passkey**：查看和刪除已註冊的Passkey
- **裝置限制**：一個裝置只能綁定一個帳號

#### 系統資訊
- **版本資訊**：查看系統版本和更新記錄
- **使用統計**：查看系統使用統計資訊

## 操作技巧

### 1. 鍵盤快捷鍵
- **Tab鍵**：在班表編輯中快速切換格子
- **Enter鍵**：確認輸入
- **ESC鍵**：取消編輯

### 2. 手機使用技巧
- **橫式顯示**：建議橫式使用以獲得更好的班表檢視體驗
- **滑動操作**：支援滑動切換月份和週別
- **縮放功能**：可縮放班表以查看詳細資訊

### 3. 班表編輯技巧
- **批次編輯**：可選擇多個格子進行批次修改
- **複製貼上**：支援班別的複製貼上操作
- **自動儲存**：系統會自動儲存編輯內容

## 常見問題 (FAQ)

### Q1: 忘記密碼怎麼辦？
A: 請聯絡系統管理者重設密碼，或使用Passkey登入（如已設定）。

### Q2: Passkey無法使用？
A: 請確認：
- 瀏覽器支援WebAuthn
- 裝置支援生物辨識或PIN碼
- 裝置未被其他帳號綁定

### Q3: 無法生成月班表？
A: 請確認：
- 已設定公式班表
- 護理師已分配到相應組別
- 檢查護理師身份設定是否正確

### Q4: 換班申請被拒絕？
A: 可能原因：
- 工時規則不符合規定
- 班別衝突
- 休息時間不足
- 護理長手動拒絕

### Q5: 醫師班表資料不正確？
A: 醫師班表資料來源於外部API，如有問題請：
- 檢查網路連線
- 等待系統自動更新（每5分鐘）
- 聯絡系統管理者

### Q6: 智能分配結果不理想？
A: 智能分配採用複雜算法，如有問題請：
- 檢查護理師身份設定是否正確
- 確認分數計算基礎是否準確
- 可嘗試部分補齊模式而非全部重新分配
- 聯絡系統管理者調整算法參數

## 系統維護

### 資料備份
- 系統會自動進行定期資料備份
- 重要操作會記錄在系統日誌中

### 效能優化
- 定期清理過期的日誌記錄
- 優化資料庫查詢效能
- 壓縮靜態資源

### 安全性
- 定期更新密碼
- 管理Passkey裝置
- 監控異常登入行為

## 技術支援

如遇到系統問題，請提供以下資訊：
- 問題發生時間
- 具體操作步驟
- 錯誤訊息截圖
- 使用的瀏覽器和作業系統

聯絡方式：
- GitHub Issues: https://github.com/Claramane/ANES_Management/issues
- 系統管理者：請聯絡資訊部門

## 版本更新說明

### v0.9.2 主要更新
- ✨ 新增醫師班表系統整合
- 🔄 自動定時更新機制
- 📊 醫師班表資料視覺化
- 🎯 PM工作分配複選功能
- 🤖 智能分配輪次演算法優化
- 🔐 WebAuthn生物辨識認證強化

### v0.9.1 更新
- 🔄 班表版本管理系統
- 📱 響應式設計優化
- 🛠️ 系統穩定性改進

### 未來更新計劃
- 與開刀房刀表系統整合
- 病人自費項目清單連結
- 醫師管理系統功能擴充
- 進階分析和報表功能

---

*最後更新：2024年12月 | 版本：v0.9.2* 